// ------------------------------
// PSYCHOMETRIC TEST APP.JS
// ------------------------------

let currentCategoryIndex = 0;
let currentQuestionIndex = 0;
let score = {};
let userAnswers = {};
let selectedLanguage = "en";

const startBtn = document.getElementById("startBtn");
const nextBtn = document.getElementById("nextBtn");
const skipBtn = document.getElementById("skipBtn");
const endBtn = document.getElementById("endBtn");
const confirmExitBtn = document.getElementById("confirmExitBtn");
const cancelExitBtn = document.getElementById("cancelExitBtn");
const langSelect = document.getElementById("langSelect");

const welcomeScreen = document.getElementById("welcomeScreen");
const testScreen = document.getElementById("testScreen");
const resultScreen = document.getElementById("resultScreen");
const modal = document.getElementById("modalBox");

const questionText = document.getElementById("questionText");
const categoryTitle = document.getElementById("categoryTitle");
const resultText = document.getElementById("resultText");

// ------------------------------
// LANGUAGE CHANGE
// ------------------------------
langSelect.addEventListener("change", e => {
  selectedLanguage = e.target.value;
  loadQuestion();
});

// ------------------------------
// START TEST
// ------------------------------
startBtn.addEventListener("click", () => {
  welcomeScreen.style.display = "none";
  testScreen.style.display = "block";
  resultScreen.style.display = "none";
  score = {};
  userAnswers = {};
  currentCategoryIndex = 0;
  currentQuestionIndex = 0;
  loadQuestion();
});

// ------------------------------
// LOAD QUESTION
// ------------------------------
function loadQuestion() {
  const categories = Object.keys(questions);
  const currentCategory = categories[currentCategoryIndex];
  const currentSet = questions[currentCategory];

  if (!currentSet || currentQuestionIndex >= currentSet.length) {
    nextCategory();
    return;
  }

  categoryTitle.textContent = `${currentCategory.toUpperCase()} (${currentQuestionIndex + 1}/${currentSet.length})`;
  questionText.textContent = currentSet[currentQuestionIndex][selectedLanguage];
}

// ------------------------------
// HANDLE ANSWER
// ------------------------------
function handleAnswer(value) {
  const category = Object.keys(questions)[currentCategoryIndex];
  if (!score[category]) score[category] = 0;
  score[category] += value;
  userAnswers[`${category}_${currentQuestionIndex}`] = value;
  currentQuestionIndex++;
  loadQuestion();
}

// ------------------------------
// NEXT QUESTION
// ------------------------------
nextBtn.addEventListener("click", () => handleAnswer(3));

// ------------------------------
// SKIP CATEGORY
// ------------------------------
skipBtn.addEventListener("click", () => {
  showMotivationalMessage("skip");
});

// ------------------------------
// END TEST (POPUP CONFIRMATION)
// ------------------------------
endBtn.addEventListener("click", () => {
  modal.style.display = "flex";
});

// ------------------------------
// MODAL CONFIRM BUTTONS
// ------------------------------
confirmExitBtn.addEventListener("click", () => {
  modal.style.display = "none";
  showMotivationalMessage("end");
});

cancelExitBtn.addEventListener("click", () => {
  modal.style.display = "none";
});

// ------------------------------
// NEXT CATEGORY
// ------------------------------
function nextCategory() {
  currentCategoryIndex++;
  currentQuestionIndex = 0;
  const categories = Object.keys(questions);

  if (currentCategoryIndex >= categories.length) {
    showResults();
  } else {
    loadQuestion();
  }
}

// ------------------------------
// SHOW RESULTS
// ------------------------------
function showResults() {
  testScreen.style.display = "none";
  resultScreen.style.display = "block";
  
  if (Object.keys(score).length === 0) {
    resultText.innerHTML = `
      <div class="motivation">
        <h2>âœ¨ Take Your Time âœ¨</h2>
        <p>We noticed you didnâ€™t complete the test. Thatâ€™s totally fine! ğŸŒ±</p>
        <p>When you feel relaxed and focused, come back â€” this test helps you understand your mind better than endless scrolling ever could.</p>
        <p>Wishing you growth and clarity ğŸ’«</p>
      </div>`;
  } else {
    let resultHTML = `<h2>ğŸ§  Your Test Summary</h2>`;
    for (const [cat, val] of Object.entries(score)) {
      resultHTML += `<p><strong>${cat.toUpperCase()}:</strong> ${val}</p>`;
    }
    resultText.innerHTML = resultHTML + `<p class='thanks'>Thank you for taking the test â¤ï¸</p>`;
  }
}

// ------------------------------
// MOTIVATIONAL MESSAGE
// ------------------------------
function showMotivationalMessage(type) {
  testScreen.style.display = "none";
  resultScreen.style.display = "block";

  if (type === "skip") {
    const cat = Object.keys(questions)[currentCategoryIndex];
    resultText.innerHTML = `
      <div class="motivation">
        <h2>â³ You Skipped ${cat.toUpperCase()}</h2>
        <p>Looks like you didnâ€™t have time right now. Thatâ€™s totally okay!</p>
        <p>When youâ€™re free, take this test again â€” itâ€™s designed to understand <strong>you</strong> better and guide your growth journey.</p>
        <p>For now, may your time go to things that truly help you â€” not just endless scrolling ğŸ˜‰</p>
        <p>ğŸŒŸ Wishing you self-awareness and peace!</p>
      </div>`;
  } else {
    resultText.innerHTML = `
      <div class="motivation">
        <h2>ğŸ’­ Test Ended Early</h2>
        <p>Not an issue if you didnâ€™t have time right now.</p>
        <p>Make sure to take the test later â€” itâ€™s a small step toward understanding your thoughts and emotions better.</p>
        <p>We hope your next few minutes go toward something meaningful, not just endless reels ğŸ˜Œ</p>
        <p>ğŸŒ± Wishing you calm focus ahead.</p>
      </div>`;
  }
}
